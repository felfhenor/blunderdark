<ng-template #placeholderPanel>
  <div class="p-4 text-sm opacity-50">Panel content will be migrated here.</div>
</ng-template>

<ng-template #resourcesPanel>
  <div class="p-2 flex flex-col gap-2">
    <app-panel-resources />
    <app-morale-bar />
  </div>
</ng-template>

<ng-template #floorsPanel>
  <div class="p-2">
    <app-panel-floor-selector />
  </div>
</ng-template>

<ng-template #timePanel>
  <div class="p-2">
    <app-panel-time-of-day />
  </div>
</ng-template>

<ng-template #buildPanel>
  <div class="p-2">
    <app-panel-room-select />
  </div>
</ng-template>

<ng-template #rosterPanel>
  <div class="p-2">
    <app-panel-roster />
  </div>
</ng-template>

<ng-template #reputationPanel>
  <div class="p-2">
    <app-panel-reputation />
  </div>
</ng-template>

<app-side-tab-rail
  [tabs]="tabDefinitions()"
  [(activePanel)]="activePanel"
  (modalTabClick)="onModalTabClick($event)"
/>

<div class="game-container relative flex flex-col">
  <div class="flex gap-4 flex-1 min-h-0">
  <div class="sidebar w-64 flex-shrink-0 flex flex-col gap-4 overflow-y-auto">
    <app-panel-merchant />
    @if (canShowFusion()) {
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body p-4 gap-2">
          <div class="flex items-center justify-between">
            <h3 class="card-title text-sm">Fusion Chamber</h3>
            <button class="btn btn-xs btn-outline" (click)="showFusion.set(true)">
              Open
            </button>
          </div>
          <p class="text-xs opacity-50">Combine two creatures into a hybrid.</p>
        </div>
      </div>
    }
    <app-panel-room-info />
    <app-panel-hallway-info />
    <app-synergy-tooltip />
    <app-panel-training-grounds />
    <app-panel-breeding-pits />
    <app-panel-summoning-circle />
    <app-panel-dark-forge />
    <app-panel-alchemy-lab />
    <app-panel-torture-chamber />
    <app-panel-altar />
    <app-panel-throne-room />
    <app-panel-research-summary (openResearch)="showResearch.set(true)" />
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body p-4">
        <div class="flex items-center justify-between">
          <h3 class="card-title text-sm">Victory Paths</h3>
          <button class="btn btn-xs btn-outline" (click)="showVictoryMenu.set(true)">
            Open
          </button>
        </div>
        <p class="text-xs opacity-50">Track your progress toward victory.</p>
      </div>
    </div>
  </div>
  <div class="flex-1 overflow-hidden">
    <app-grid />
  </div>
  </div>
</div>

<app-game-research [(visible)]="showResearch" />
<app-panel-fusion [(visible)]="showFusion" />
<app-panel-victory />
<app-victory-menu [(visible)]="showVictoryMenu" />

@if (isAutosaving()) {
  <div class="fixed bottom-4 right-4 z-50 flex items-center gap-2 bg-base-300 rounded-lg px-3 py-2 shadow-lg opacity-80 pointer-events-none">
    <span class="loading loading-spinner loading-xs"></span>
    <span class="text-xs font-mono">Saving...</span>
  </div>
}

<ng-container [appTeleportOutlet]="'menu-options'"></ng-container>
