<div class="resource-bar-top">
  @for (res of resources; track res.type) {
    <div
      class="resource-chip"
      [class.text-success]="res.type !== 'corruption' && isFull(res.type)"
      [tp]="resourceTip"
      tpPlacement="bottom"
      [tpDelay]="250"
    >
      <app-currency-name [type]="res.type" [short]="true" [amount]="getCurrent(res.type)" />
      @if (res.type === 'corruption') {
        <span class="badge badge-xs ml-1" [class]="getCorruptionBadgeClass(corruptionInfo().level)">
          {{ corruptionInfo().level | uppercase }}
        </span>
      } @else {
        <span class="resource-max" [class.text-success]="isFull(res.type)" [class.opacity-50]="!isFull(res.type)">/{{ getMax(res.type) | number: '1.0-0' }}</span>
      }
    </div>

    <ng-template #resourceTip>
      <div class="w-[300px]">
        <div class="font-semibold text-sm mb-1"><app-currency-name [type]="res.type" /></div>
        <div class="text-xs opacity-70 mb-2">{{ res.description }}</div>

        <progress
          class="progress w-full h-2 mb-2"
          [class]="res.type === 'corruption' ? 'corruption-progress-' + corruptionInfo().level : res.color"
          [value]="getPercent(res.type)"
          max="100"
        ></progress>

        <div class="flex justify-between text-xs mb-1">
          <span class="opacity-70">Amount:</span>
          @if (res.type === 'corruption') {
            <span>{{ getCurrent(res.type) | number: '1.0-0' }}</span>
          } @else {
            <span>{{ getCurrent(res.type) | number: '1.0-1' }} / {{ getMax(res.type) | number: '1.0-0' }}</span>
          }
        </div>

        @if (res.type === 'corruption') {
          <div class="flex justify-between text-xs mb-1">
            <span class="opacity-70">Level:</span>
            <span class="font-semibold" [class]="getCorruptionColorClass(corruptionInfo().level)">
              {{ corruptionInfo().level | uppercase }}
            </span>
          </div>
          <div class="divider my-1 h-0"></div>
          <div class="text-xs opacity-80">{{ corruptionInfo().description }}</div>
        }

        @if (getResourceBreakdown(res.type); as info) {
          <div class="divider my-1 h-0"></div>
          <div class="text-xs font-semibold mb-1">Rate Breakdown</div>
          <div class="flex flex-col gap-0.5 text-xs">
            @if (info.prod; as bd) {
              <div class="flex justify-between">
                <span class="opacity-70">Base:</span>
                <span>{{ formatBreakdownRate(bd.base) }}/min</span>
              </div>
              @if (bd.inhabitantBonus !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Workers:</span>
                  <span class="text-success">{{ formatBreakdownRate(bd.inhabitantBonus) }}/min</span>
                </div>
              }
              @if (bd.adjacencyBonus !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Adjacency:</span>
                  <span class="text-success">{{ formatBreakdownRate(bd.adjacencyBonus) }}/min</span>
                </div>
              }
              @if (bd.modifierEffect !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Modifiers:</span>
                  <span [class]="bd.modifierEffect > 0 ? 'text-success' : 'text-error'">
                    {{ formatBreakdownRate(bd.modifierEffect) }}/min
                  </span>
                </div>
              }
            }
            @if (info.cons; as cd) {
              @if (cd.inhabitantFood !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Feeding:</span>
                  <span class="text-error">{{ formatBreakdownRate(-cd.inhabitantFood) }}/min</span>
                </div>
              }
              @if (cd.legendaryUpkeep !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Legendary Upkeep:</span>
                  <span class="text-error">{{ formatBreakdownRate(-cd.legendaryUpkeep) }}/min</span>
                </div>
              }
              @if (cd.featureMaintenance !== 0) {
                <div class="flex justify-between">
                  <span class="opacity-70">Maintenance:</span>
                  <span class="text-error">{{ formatBreakdownRate(-cd.featureMaintenance) }}/min</span>
                </div>
              }
            }
            <div class="divider my-0.5 h-0"></div>
            <div class="flex justify-between font-semibold">
              <span>Net:</span>
              <span [class]="info.net > 0 ? 'text-success' : info.net < 0 ? 'text-error' : ''">{{ formatBreakdownRate(info.net) }}/min</span>
            </div>
          </div>
        }
      </div>
    </ng-template>
  }
</div>
