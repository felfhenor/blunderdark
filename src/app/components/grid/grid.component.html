<div class="grid-container" [class.hallway-mode]="isHallwayMode()" [attr.data-corruption]="corruptionLevel()" (mouseleave)="onGridLeave()" (contextmenu)="onRightClick($event)">
  @for (row of grid(); track rowIdx; let rowIdx = $index) {
    @for (tile of row; track colIdx; let colIdx = $index) {
      <div
        class="grid-tile"
        [class.occupied]="tile.occupied"
        [class.room-tile]="tile.roomId"
        [class.selected]="isSelected(colIdx, rowIdx)"
        [class.preview-valid]="isPreviewValid(colIdx, rowIdx)"
        [class.preview-invalid]="isPreviewInvalid(colIdx, rowIdx)"
        [class.hallway-source]="isHallwaySourceRoom(tile.roomId)"
        [class.hallway-path]="isHallwayPathTile(colIdx, rowIdx)"
        [style.--room-color]="getRoomColor(tile.roomId)"
        [style]="getRoomBorderStyle(colIdx, rowIdx)"
        (click)="onTileClick(colIdx, rowIdx)"
        (mouseenter)="onTileHover(colIdx, rowIdx)"
      >
        @if (isRoomAnchor(colIdx, rowIdx, tile.roomId)) {
          <span class="room-label">{{ getRoomName(tile.roomId) }}</span>
          <app-fear-indicator class="fear-grid-badge" [roomId]="tile.roomId!" />
          @if (getAssignmentInfo(tile.roomId); as info) {
            <span
              class="assignment-badge"
              [class.status-full]="info.status === 'full'"
              [class.status-partial]="info.status === 'partial'"
              [class.status-empty]="info.status === 'empty'"
            >{{ info.current }}/{{ info.max === -1 ? '\u221E' : info.max }}</span>
          }
        }
        @if (getDoorways(colIdx, rowIdx); as dirs) {
          @if (dirs.has('top')) {
            <div class="doorway doorway-top"></div>
          }
          @if (dirs.has('right')) {
            <div class="doorway doorway-right"></div>
          }
          @if (dirs.has('bottom')) {
            <div class="doorway doorway-bottom"></div>
          }
          @if (dirs.has('left')) {
            <div class="doorway doorway-left"></div>
          }
        }
      </div>
    }
  }
</div>
