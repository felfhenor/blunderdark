<div class="grid-container" [class.hallway-mode]="isHallwayMode()" [class]="'corruption-' + corruptionLevel()" (mouseleave)="onGridLeave()" (contextmenu)="onRightClick($event)">
  @for (row of grid(); track rowIdx; let rowIdx = $index) {
    @for (tile of row; track colIdx; let colIdx = $index) {
      <div
        class="grid-tile"
        [class.occupied]="tile.occupied"
        [class.room-tile]="tile.roomId"
        [class.selected]="isSelected(colIdx, rowIdx)"
        [class.preview-valid]="isPreviewValid(colIdx, rowIdx)"
        [class.preview-invalid]="isPreviewInvalid(colIdx, rowIdx)"
        [class.hallway-start]="isHallwayStartTile(colIdx, rowIdx)"
        [class.hallway-end]="isHallwayEndTile(colIdx, rowIdx)"
        [class.hallway-path]="isHallwayPathTile(colIdx, rowIdx)"
        [style.--room-color]="getRoomColor(tile.roomId)"
        [style.--room-border-color]="getRoomBorderColor(colIdx, rowIdx)"
        [class]="getRoomBorderClasses(colIdx, rowIdx)"
        (click)="onTileClick(colIdx, rowIdx)"
        (mouseenter)="onTileHover(colIdx, rowIdx)"
      >
        @if (isRoomAnchor(colIdx, rowIdx, tile.roomId)) {
          <span class="room-label" [style.--room-center-offset]="getRoomLabelOffset(tile.roomId)">{{ getRoomName(tile.roomId) }}@if (getAssignmentInfo(tile.roomId); as info) {<span class="assignment-inline" [class.status-full]="info.status === 'full'" [class.status-partial]="info.status === 'partial'" [class.status-empty]="info.status === 'empty'"> ({{ info.current }}/{{ info.max === -1 ? '\u221E' : info.max }})</span>}</span>
          <app-fear-indicator class="fear-grid-badge" [style.--room-center-offset]="getRoomLabelOffset(tile.roomId)" [roomId]="tile.roomId!" />
        }
        @if (getDoorways(colIdx, rowIdx); as dirs) {
          @if (dirs.has('top')) {
            <div class="doorway doorway-top"></div>
          }
          @if (dirs.has('right')) {
            <div class="doorway doorway-right"></div>
          }
          @if (dirs.has('bottom')) {
            <div class="doorway doorway-bottom"></div>
          }
          @if (dirs.has('left')) {
            <div class="doorway doorway-left"></div>
          }
        }
        @if (getHallwayDoorways(colIdx, rowIdx); as hdirs) {
          @if (hdirs.has('top')) {
            <div class="doorway doorway-top"></div>
          }
          @if (hdirs.has('right')) {
            <div class="doorway doorway-right"></div>
          }
          @if (hdirs.has('bottom')) {
            <div class="doorway doorway-bottom"></div>
          }
          @if (hdirs.has('left')) {
            <div class="doorway doorway-left"></div>
          }
        }
      </div>
    }
  }
</div>
