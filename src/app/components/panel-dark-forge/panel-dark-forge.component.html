@if (forgeRoom(); as room) {
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body p-4">
      <!-- Active Queue -->
      @if (queueState(); as qs) {
        <div class="divider my-2 text-xs opacity-60">Crafting Queue ({{ qs.jobs.length | number:'1.0-2' }}/{{ qs.maxSize | number:'1.0-2' }})</div>
          <div class="flex flex-col gap-1">
            @for (job of qs.jobs; track job.index) {
              <div class="flex flex-col gap-1 p-1 bg-base-200 rounded">
                <div class="flex items-center justify-between">
                  <span class="text-xs">{{ job.recipeName }}</span>
                  <div class="flex items-center gap-1">
                    @if (job.isActive) {
                      <span class="badge badge-xs badge-warning">Forging</span>
                    } @else {
                      <span class="badge badge-xs badge-ghost">Queued</span>
                    }
                    <button
                      class="btn btn-xs btn-ghost btn-circle"
                      (click)="cancelJob(job.index)"
                    >x</button>
                  </div>
                </div>
                @if (job.isActive) {
                  <progress
                    class="progress progress-warning w-full"
                    [value]="job.percent"
                    max="100"
                  ></progress>
                  <span class="text-xs opacity-40">{{ job.percent | number:'1.0-2' }}%</span>
                }
              </div>
            }
          </div>
      }

      <!-- Assigned Workers -->
      @if (assignedWorkers().length > 0) {
        <div class="divider my-2 text-xs opacity-60">Workers</div>
          <div class="flex flex-wrap gap-1">
            @for (w of assignedWorkers(); track w.instanceId) {
              <span class="badge badge-xs badge-outline">{{ w.defName }}</span>
            }
          </div>
      } @else {
        <p class="text-xs opacity-50 mt-2">No workers assigned.</p>
      }

      <!-- Available Recipes -->
      @if (availableRecipes().length > 0) {
        <div class="divider my-2 text-xs opacity-60">Recipes</div>
          <div class="flex flex-col gap-2">
            @for (entry of availableRecipes(); track entry.recipe.id) {
              <div class="flex flex-col gap-1 p-2 bg-base-200 rounded">
                <div class="flex items-center justify-between">
                  <span class="text-xs font-semibold">{{ entry.recipe.name }}</span>
                  <span class="badge badge-xs" [class.badge-info]="entry.recipe.category === 'equipment'" [class.badge-secondary]="entry.recipe.category === 'upgrade'">{{ entry.recipe.category }}</span>
                </div>
                <span class="text-xs opacity-60">{{ entry.recipe.description }}</span>
                <span class="text-xs opacity-50">Cost:
                  @for (cost of formatCost(entry.recipe.cost); track cost.type) {
                    {{ cost.amount }} <app-currency-name [type]="cost.type" />@if (!$last) {, }
                  }
                </span>
                <span class="text-xs opacity-50">Time: {{ entry.timeMinutes | number:'1.0-2' }} min</span>
                @if (entry.recipe.tier === 'advanced') {
                  <span class="badge badge-xs badge-accent">Advanced</span>
                }
                @if (formatStatBonuses(entry.statBonuses); as bonusStr) {
                  @if (bonusStr) {
                    <span class="text-xs text-success">Bonuses: {{ bonusStr }}</span>
                  }
                }
                <button
                  class="btn btn-xs btn-warning mt-1"
                  [disabled]="!entry.canAfford"
                  (click)="startCrafting(entry.recipe.id, entry.ticks, entry.recipe.cost)"
                >
                  @if (entry.canAfford) {
                    Start Crafting
                  } @else {
                    Not enough resources
                  }
                </button>
              </div>
            }
          </div>
      }

      <!-- Forge Inventory -->
      @if (forgeInventory().length > 0) {
        <div class="divider my-2 text-xs opacity-60">Forge Inventory</div>
          <div class="flex flex-col gap-1">
            @for (item of forgeInventory(); track item.recipeId) {
              <div class="flex items-center justify-between">
                <span class="text-xs">{{ item.name }}</span>
                <span class="badge badge-xs badge-outline">x{{ item.count | number:'1.0-2' }}</span>
              </div>
            }
          </div>
      }
    </div>
  </div>
}
