@if (hasActiveEffects()) {
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body p-4">
      <h3 class="card-title text-sm">Active Seasonal Effects</h3>
      <div class="flex flex-col gap-1">
        @for (effect of activeEffects(); track effect.description) {
          <div class="flex items-center justify-between text-xs">
            <span class="opacity-70">{{ effect.description }}</span>
            <span class="badge badge-xs badge-info">{{ effect.remainingDays }}d</span>
          </div>
        }
      </div>
    </div>
  </div>
}

<app-modal [(visible)]="visible" widthClass="max-w-lg">
  <span title>Seasonal Event</span>

  <div body>
    @if (pendingEvent(); as event) {
      <div class="flex items-center gap-2 mb-2">
        <span class="badge badge-sm badge-outline">{{ eventSeasonLabel() }}</span>
        <span class="font-semibold">{{ event.name }}</span>
      </div>

      <p class="text-sm italic opacity-70 mb-3">{{ event.flavorText }}</p>

      @if (!isChoiceEvent()) {
        <div class="flex flex-col gap-1.5 mb-3">
          @for (effect of event.effects; track effect.description) {
            <div class="flex items-center gap-2">
              <span
                class="badge badge-xs"
                [class]="getEffectBadgeClass(effect)"
              >{{ effect.type === 'resource_gain' ? '+' : effect.type === 'resource_loss' ? '-' : '~' }}</span>
              <span class="text-xs">{{ effect.description }}</span>
            </div>
          }
        </div>
      }

      @if (isChoiceEvent()) {
        <p class="text-xs opacity-50 mb-2">Choose your response:</p>
        <div class="flex flex-col gap-2">
          @for (choice of event.choices; track choice.label; let i = $index) {
            <button
              class="btn btn-sm btn-outline text-left flex flex-col items-start h-auto py-2"
              (click)="makeChoice(i)"
            >
              <span class="font-semibold text-sm">{{ choice.label }}</span>
              <span class="text-xs opacity-60 font-normal">{{ choice.description }}</span>
              <div class="flex flex-wrap gap-1 mt-1">
                @for (effect of choice.effects; track effect.description) {
                  <span
                    class="badge badge-xs"
                    [class]="getEffectBadgeClass(effect)"
                  >{{ effect.description }}</span>
                }
              </div>
            </button>
          }
        </div>
      }
    }
  </div>

  <div actions>
    @if (!isChoiceEvent()) {
      <button class="btn btn-sm btn-primary" (click)="dismiss()">Acknowledge</button>
    }
  </div>
</app-modal>
