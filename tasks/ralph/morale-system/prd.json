{
  "project": "Blunderdark",
  "branchName": "ralph/morale-system",
  "description": "Morale System - Party-level invader morale (0-100) that decreases on ally death, traps, and fear rooms, increases on captures, triggers retreat at zero, enabling non-lethal defense victories.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement morale state tracking and event modifiers",
      "description": "As a developer, I want morale tracked as a party-level signal with defined event modifiers.",
      "acceptanceCriteria": [
        "partyMorale signal (WritableSignal<number>) initialized to 100 at invasion start, clamped 0-100",
        "Ally death: -10 morale (Cleric/Paladin death: -15)",
        "Trap trigger: -5 morale (Fear Glyph: -10 total)",
        "High-fear room entry (fear >= 3): -15 morale (once per room entry, negated by Paladin Aura of Courage)",
        "Room capture: +10 morale (+15 for high-value rooms like Vault/Library)",
        "Morale resets to 100 at start of each new invasion",
        "Helper in src/app/helpers/morale.ts; types in src/app/interfaces/",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement retreat behavior at zero morale",
      "description": "As a developer, I want invaders to retreat when morale hits 0 so that fear-based defense is viable.",
      "acceptanceCriteria": [
        "When partyMorale reaches 0, all invaders enter 'retreating' state",
        "Retreating invaders move toward dungeon entrance, do not attack defenders",
        "Retreating invaders can still be attacked by defenders",
        "Invasion ends when all retreating invaders exit or are killed",
        "Retreat counts as successful defense for reward purposes",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create morale bar UI with event log",
      "description": "As a player, I want to see invader morale as a bar with change events during invasions.",
      "acceptanceCriteria": [
        "Morale bar displayed during invasion mode showing current/100",
        "Color coded: green (>60), yellow (30-60), red (<30); animates smoothly on changes",
        "Floating text on morale changes (e.g., '-10 Ally Fallen')",
        "Each change logged with: turn number, event type, delta, new value",
        "Log accessible via tooltip or expandable panel on morale bar",
        "Component uses OnPush change detection",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Write morale system unit tests",
      "description": "As a developer, I want comprehensive tests for the morale system.",
      "acceptanceCriteria": [
        "Test: Morale initializes to 100; clamps to 0 and 100",
        "Test: Ally death -10, Cleric/Paladin death -15",
        "Test: Trap trigger -5, Fear Glyph -10",
        "Test: High fear room -15; Paladin aura negation",
        "Test: Room capture +10; cap at 100",
        "Test: Zero morale triggers retreat state",
        "Tests in src/app/helpers/morale.spec.ts",
        "All tests pass with npm run test",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    }
  ]
}
