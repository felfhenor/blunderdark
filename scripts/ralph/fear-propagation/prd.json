{
  "project": "Blunderdark",
  "branchName": "ralph/fear-propagation",
  "description": "Fear Propagation - Causes high-fear rooms (level 3+) to increase fear in adjacent rooms, with configurable propagation distance per inhabitant type and distance-based attenuation.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement fear propagation calculation function",
      "description": "As a developer, I want a pure function that computes propagated fear for a room so that the logic is testable and avoids circular feedback loops.",
      "acceptanceCriteria": [
        "A function calculatePropagatedFear(room, adjacentRooms, grid): number exists in src/app/helpers/",
        "Rooms with High (3) fear propagate +1 fear to adjacent rooms; Very High (4) propagates +2",
        "Only source fear (base + inhabitant modifiers) is used for propagation, not effective fear, to avoid feedback loops",
        "Propagated fear from multiple sources stacks additively",
        "Function returns the total propagated fear modifier (not the final clamped value)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement variable propagation distance",
      "description": "As a developer, I want fear propagation to support configurable distance so that certain creatures can spread fear farther.",
      "acceptanceCriteria": [
        "Default propagation distance is 1 (only directly adjacent rooms)",
        "Specific inhabitant types can extend propagation distance (e.g., Medusa: distance 2) defined in gamedata",
        "Distance 2 means rooms adjacent to adjacent rooms also receive propagated fear",
        "Fear decreases by 1 per propagation step beyond the first",
        "Adjacency map supports 'neighbors of neighbors' queries for distance-2 propagation",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Integrate propagation with reactive signals and recalculation triggers",
      "description": "As the system, I want fear propagation to recalculate reactively when relevant state changes so that fear is always accurate.",
      "acceptanceCriteria": [
        "Propagation recalculates when a room is placed or removed",
        "Propagation recalculates when an inhabitant is assigned or removed",
        "Propagation recalculates when a room's base fear changes (e.g., via upgrade)",
        "Propagation recalculates when rooms are connected or disconnected",
        "Effective fear (base + inhabitants + propagated) is clamped to [0, 4]",
        "Propagated fear is computed using computed() signals, not stored separately",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Write unit tests for fear propagation",
      "description": "As a developer, I want comprehensive tests for fear propagation logic so that it is reliable.",
      "acceptanceCriteria": [
        "Test: no propagation from rooms with fear < 3",
        "Test: single High source propagates +1 to adjacent room",
        "Test: single Very High source propagates +2 to adjacent room",
        "Test: multiple sources stack propagated fear",
        "Test: distance-2 propagation with attenuation",
        "Test: effective fear is clamped to [0, 4]",
        "Tests located in src/app/helpers/ spec file",
        "All tests pass with npm run test",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Display propagated fear in room UI",
      "description": "As a dungeon builder, I want to see which rooms are affected by fear propagation so that I can manage my layout.",
      "acceptanceCriteria": [
        "Rooms with propagated fear show an indicator (e.g., 'Fear: Medium (+1 from adjacent Soul Well)')",
        "The source of propagated fear is identified in the tooltip",
        "The display distinguishes between base fear, inhabitant modifiers, and propagated fear",
        "Component uses OnPush change detection",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ]
}
