{
  "project": "Blunderdark",
  "branchName": "ralph/room-placement-validation",
  "description": "Room placement validation checking grid bounds, tile occupation, and overlap conflicts with visual and textual feedback",
  "userStories": [
    {
      "id": "US-001",
      "title": "Bounds Validation",
      "description": "As a developer, I want a function that checks whether a room shape fits within the grid bounds so that rooms cannot extend outside the grid",
      "acceptanceCriteria": [
        "A function validateBounds(shape, anchorX, anchorY, gridSize) returns {valid, error?}",
        "Returns invalid with message 'Room extends beyond grid boundary' when any tile falls outside 0-19 range",
        "Works correctly for all 6 shape variants at edge positions",
        "Unit tests cover corner cases: placement at (0,0), (18,18), (19,19), and negative coordinates",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "validateBounds() in src/app/helpers/room-placement.ts with 9 unit tests covering (0,0), (18,18), (19,19), negative coords, L-shape and I-shape edges"
    },
    {
      "id": "US-002",
      "title": "Overlap Validation",
      "description": "As a developer, I want a function that checks whether a room shape overlaps any existing occupied tiles so that rooms cannot stack on top of each other",
      "acceptanceCriteria": [
        "A function validateNoOverlap(shape, anchorX, anchorY, grid) returns {valid, error?, conflictingTiles?}",
        "Returns invalid with message 'Tiles already occupied' when any target tile has occupied === true",
        "Returns the list of conflicting tile coordinates for debugging/UI",
        "Unit tests cover: empty grid (valid), partially occupied grid (invalid), fully occupied grid (invalid)",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "validateNoOverlap() returns conflictingTiles array, 4 unit tests"
    },
    {
      "id": "US-003",
      "title": "Combined Validation Function",
      "description": "As a developer, I want a single validation function that runs all checks so that callers don't need to invoke each validation separately",
      "acceptanceCriteria": [
        "A function validatePlacement(shape, anchorX, anchorY, grid) runs bounds + overlap checks",
        "Returns a result object: {valid, errors: string[]}",
        "Errors array contains all applicable error messages not just the first failure",
        "Function is in src/app/helpers/room-placement.ts",
        "Unit tests in src/app/helpers/room-placement.spec.ts cover combined scenarios",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "validatePlacement() collects all errors, 4 unit tests including dual-error scenario"
    },
    {
      "id": "US-004",
      "title": "Visual Placement Feedback",
      "description": "As a player, I want to see green or red tile highlights when placing a room so that I know whether the placement is valid before clicking",
      "acceptanceCriteria": [
        "When previewing a room placement, valid tiles show a green overlay",
        "Invalid tiles (occupied or out of bounds) show a red overlay",
        "If any tile in the shape is invalid, all tiles in the preview show red",
        "Feedback updates in real-time as the mouse moves across the grid",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Added placement preview signals (placementPreviewShape, placementPreviewPosition, placementPreview computed) to room-placement.ts. GridComponent shows green (.preview-valid) or red (.preview-invalid) overlay on tiles based on validation. Mouse hover updates preview position. Escape key clears preview. CSS uses OKLCH colors. Browser verified: CSS rules compile correctly with Angular view encapsulation."
    },
    {
      "id": "US-005",
      "title": "Placement Error Messages",
      "description": "As a player, I want to see a clear message when I try to place a room in an invalid location so that I understand what went wrong",
      "acceptanceCriteria": [
        "When clicking to place in an invalid position, a notification appears with the error reason",
        "Error messages are player-friendly (e.g. 'Cannot place room: tiles are already occupied')",
        "Uses the existing NotifyService for displaying messages",
        "Multiple errors are combined into a single notification",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Added formatPlacementErrors() and attemptPlacement() to room-placement.ts. GridComponent calls attemptPlacement() on click during preview mode, shows error via notifyError(). Player-friendly messages combine multiple errors. 5 unit tests added."
    }
  ]
}
