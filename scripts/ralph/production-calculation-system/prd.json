{
  "project": "Blunderdark",
  "branchName": "ralph/production-calculation-system",
  "description": "Production calculation system that determines per-tick resource generation for each room, factoring in base rates, inhabitant bonuses, adjacency effects, and conditional modifiers",
  "userStories": [
    {
      "id": "US-001",
      "title": "Base Production per Room Type",
      "description": "As a developer, I want each room type to define a base production rate so that rooms generate resources",
      "acceptanceCriteria": [
        "Room type definitions in gamedata/room/ YAML include a production field specifying resource type and base amount per tick",
        "A function getBaseProduction(roomTypeId) returns the base production for a room type",
        "Rooms with no production defined return zero",
        "Base production values are loaded via ContentService at init",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Inhabitant Efficiency Bonuses",
      "description": "As a developer, I want inhabitant efficiency traits to modify room production so that assigning the right inhabitants matters",
      "acceptanceCriteria": [
        "A function calculateInhabitantBonus(room) sums the efficiency bonuses from all assigned inhabitants",
        "Bonus is additive: two inhabitants with +20% each equals +40% total",
        "Unassigned rooms have 0% bonus but still get base production if room produces passively, or 0 if room requires workers",
        "Unit tests cover: no inhabitants, one inhabitant, multiple inhabitants with different bonuses",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Adjacency Bonuses",
      "description": "As a developer, I want rooms to receive bonuses based on adjacent rooms so that dungeon layout matters strategically",
      "acceptanceCriteria": [
        "A function calculateAdjacencyBonus(room, grid, allRooms) checks neighboring tiles for compatible room types",
        "Adjacency rules are defined in gamedata (e.g. Mine gets +10% when adjacent to Forge)",
        "Adjacency is determined by shared tile edges between rooms, not diagonal",
        "Multiple adjacency bonuses stack additively",
        "Unit tests cover: no adjacent rooms, one match, multiple matches, non-matching neighbors",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Conditional Modifiers",
      "description": "As a developer, I want conditional modifiers like fear, hunger, and time of day to affect production so that the game has dynamic resource management",
      "acceptanceCriteria": [
        "A function calculateConditionalModifiers(room) returns a multiplier based on active conditions",
        "Scared inhabitants produce at 50% efficiency (multiplier 0.5)",
        "Hungry inhabitants produce at 75% efficiency (multiplier 0.75)",
        "Modifiers are multiplicative with each other (scared + hungry = 0.375)",
        "Normal state has multiplier of 1.0",
        "Unit tests cover each condition and combinations",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Per-Tick Production Update",
      "description": "As a developer, I want production calculated and applied every game tick so that resources accumulate over time",
      "acceptanceCriteria": [
        "A function processProduction(gameState) iterates all placed rooms and calculates total production",
        "Production formula applied: Final = Base * (1 + Bonuses) * Modifiers per room, summed across all rooms",
        "Results are passed to the resource manager addResource() for each resource type",
        "Function is called from the game loop in gameloop.ts each tick",
        "Production calculation completes within 2ms for up to 50 rooms",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Production Summary Signal",
      "description": "As a developer, I want a signal exposing current production rates so that the UI can display per-minute production",
      "acceptanceCriteria": [
        "A computed signal productionRates() returns the aggregate production per tick for each resource type",
        "A helper productionPerMinute(type) converts per-tick rate to per-minute for display",
        "Per-room production breakdown is available via roomProduction(roomId) signal",
        "Signals update when rooms, inhabitants, or modifiers change",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    }
  ]
}
