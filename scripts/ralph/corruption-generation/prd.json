{
  "project": "Blunderdark",
  "branchName": "ralph/corruption-generation",
  "description": "Corruption Generation - Define sources and rates of automatic Corruption generation from dark rooms and creatures.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define room-based Corruption generation rates",
      "description": "As a developer, I want dark rooms to generate Corruption automatically.",
      "acceptanceCriteria": [
        "Soul Well generates +2 Corruption per game minute",
        "Torture Chamber generates +3 Corruption per game minute",
        "Generation only occurs when the room is operational",
        "Generation rate defined in room data (YAML or config)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Soul Well generates corruption: 0.4 per tick (2/min) and Shadow Library generates corruption: 0.2 per tick (1/min) via the existing production pipeline (YAML data). Torture Chamber does not exist yet (Phase 15.6) - will add corruption generation when that room is created."
    },
    {
      "id": "US-002",
      "title": "Define inhabitant-based Corruption generation",
      "description": "As a developer, I want dark creatures to generate Corruption when stationed.",
      "acceptanceCriteria": [
        "Skeleton generates +1 Corruption per game minute when stationed",
        "Demon Lord generates +10 Corruption per game minute when stationed",
        "Unstationed inhabitants do not generate Corruption",
        "Generation rate defined in inhabitant data",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Added corruptionGeneration field to InhabitantDefinition interface. Skeleton has corruptionGeneration: 1, Demon Lord has corruptionGeneration: 10 in YAML. corruptionGenerationCalculateInhabitantRate() skips unstationed inhabitants. ensureInhabitant() defaults to 0."
    },
    {
      "id": "US-003",
      "title": "Integrate Corruption accumulation with production tick",
      "description": "As a developer, I want Corruption to accumulate during the normal production tick.",
      "acceptanceCriteria": [
        "Calculate total Corruption generation per tick from all active sources",
        "Add generated Corruption to the global pool each tick",
        "Generation respects time-of-day modifiers (Night: +50%)",
        "Generation respects biome modifiers (Corrupted: +100% dark room Corruption)",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "corruptionGenerationProcess(state) runs each tick in gameloop.ts after productionProcess. Applies day/night modifier via dayNightGetResourceModifier(). Biome modifiers for room-based corruption are applied via the existing production pipeline (floor-modifiers.ts depth tiers already include corruption bonuses). Room corruption flows through productionProcess; inhabitant corruption flows through corruptionGenerationProcess."
    },
    {
      "id": "US-004",
      "title": "Display Corruption source summary in UI",
      "description": "As a player, I want to see what is generating Corruption so I can manage it.",
      "acceptanceCriteria": [
        "Show Corruption generation rate (per minute) in the resource panel",
        "Tooltip breaks down generation by source (rooms, inhabitants)",
        "Show modifier effects on generation rate",
        "Component uses OnPush change detection",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Deferred - requires UI work and browser verification. corruptionGenerationCalculateTotalPerMinute() utility function is available for UI consumption."
    },
    {
      "id": "US-005",
      "title": "Add Corruption generation unit tests",
      "description": "As a developer, I want tests for Corruption generation calculations.",
      "acceptanceCriteria": [
        "Test: Soul Well generates 2 Corruption per minute",
        "Test: Torture Chamber generates 3 Corruption per minute",
        "Test: Stationed Skeleton adds 1 Corruption per minute",
        "Test: Night modifier increases generation by 50%",
        "Tests in src/app/helpers/corruption.spec.ts",
        "All tests pass with npm run test",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "31 tests in corruption.spec.ts covering: inhabitant rate calculation (no inhabitants, unstationed, Skeleton 1/min, Demon Lord 10/min, multiple, no generation, undefined generation), process function (no inhabitants, stationed skeleton, night modifier +50%, unstationed), total per-minute calculation. Soul Well corruption tested via production pipeline. Torture Chamber deferred (room doesn't exist yet)."
    }
  ]
}
