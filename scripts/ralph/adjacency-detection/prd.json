{
  "project": "Blunderdark",
  "branchName": "ralph/adjacency-detection",
  "description": "Adjacency Detection - Detect edge-sharing adjacency between rooms on the grid, maintain a cached adjacency map, and provide a query API.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement edge-sharing validation pure function",
      "description": "As a developer, I want a pure function that determines whether two sets of tiles are edge-adjacent so that the detection logic is testable in isolation.",
      "acceptanceCriteria": [
        "A pure function areRoomsAdjacent(tilesA, tilesB) exists in src/app/helpers/",
        "Two tiles at (x, y) and (x+1, y) are edge-adjacent (horizontal)",
        "Two tiles at (x, y) and (x, y+1) are edge-adjacent (vertical)",
        "Two tiles at (x, y) and (x+1, y+1) are NOT adjacent (diagonal)",
        "Unit tests cover horizontal, vertical, diagonal, and non-touching cases",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "areRoomsAdjacent() in src/app/helpers/adjacency.ts with 9 tests"
    },
    {
      "id": "US-002",
      "title": "Implement adjacency cache data structure",
      "description": "As a developer, I want adjacency data cached in a Map so that lookups are fast and do not require re-scanning the grid.",
      "acceptanceCriteria": [
        "Adjacency data stored in a Map<string, Set<string>> (roomId to set of adjacent roomIds)",
        "Cache is updated incrementally on place/remove, not recomputed from scratch",
        "Accessing adjacency for a room is O(1)",
        "Cache is serializable for save/load (converted to plain objects)",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "AdjacencyMap type uses Record<string, string[]> for JSON-serializable cache structure"
    },
    {
      "id": "US-003",
      "title": "Compute adjacency on room placement",
      "description": "As the dungeon builder, I want the system to automatically detect which rooms are adjacent when I place a new room.",
      "acceptanceCriteria": [
        "When a room is placed on the grid, the adjacency map is updated",
        "Adjacency detected by checking if any tile of Room A is directly left/right/above/below any tile of Room B",
        "Diagonal (corner) touching does not count as adjacent",
        "The newly placed room's adjacency list is populated",
        "All other rooms' adjacency lists are updated if they are now adjacent to the new room",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "addRoomToAdjacencyMap() handles bidirectional updates on placement"
    },
    {
      "id": "US-004",
      "title": "Update adjacency on room removal",
      "description": "As the dungeon builder, I want adjacency data to update when a room is removed so that stale connections are cleaned up.",
      "acceptanceCriteria": [
        "When a room is removed, it is removed from every other room's adjacency list",
        "The removed room's own adjacency entry is deleted from the cache",
        "Any active connections referencing the removed room are also invalidated",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "removeRoomFromAdjacencyMap() cleans up all references"
    },
    {
      "id": "US-005",
      "title": "Implement query API for adjacent rooms",
      "description": "As a developer, I want to query the adjacency map for a given room and receive a list of adjacent rooms.",
      "acceptanceCriteria": [
        "A function getAdjacentRooms(roomId) exists and returns the correct list",
        "Returns an empty array if the room has no neighbors",
        "Returns consistent results regardless of query order",
        "Unit tests verify query results for various room configurations",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "getAdjacentRooms() returns empty array for unknown roomIds"
    }
  ]
}
