{
  "project": "Blunderdark",
  "branchName": "ralph/conditional-production-modifiers",
  "description": "Conditional Production Modifiers - Dynamic multipliers based on time of day, fear, hunger, floor depth, and biome that stack multiplicatively.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define modifier type system and registry",
      "description": "As a developer, I want modifier types defined as data so new modifiers can be added without refactoring.",
      "acceptanceCriteria": [
        "A ProductionModifier type defined with id, type, multiplier, condition, description fields",
        "Modifier types include: time-of-day, fear, hunger, floor-depth, biome",
        "Each modifier has a condition function evaluating against game state",
        "Modifiers registered in a central registry",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "ProductionModifierDefinition type with id, type, description, evaluate function. ProductionModifierContext provides roomTypeId, floorDepth, floorBiome, hour. Registry holds 3 modifiers (time_of_day, floor_depth, biome). Fear/hunger handled by state-modifiers system (10.1)."
    },
    {
      "id": "US-002",
      "title": "Implement multiplicative stacking helper",
      "description": "As a developer, I want modifiers to stack multiplicatively with a helper function.",
      "acceptanceCriteria": [
        "Final production = base * (1 + adjacency%) * fearMod * hungerMod * timeMod * depthMod * biomeMod",
        "Each modifier is a multiplier (e.g., 0.8 for -20%, 1.2 for +20%)",
        "A helper function applyModifiers(base, modifiers) exists",
        "Unit tests verify correct stacking with 0, 1, 2, and 5 modifiers",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "applyModifiers(base, modifiers) multiplies sequentially. calculateProductionModifiers(context) evaluates all registry modifiers and multiplies results. Production pipeline: final = base * (1 + inhabitant + adjacency) * stateModifier * envModifier."
    },
    {
      "id": "US-003",
      "title": "Implement time-of-day modifiers",
      "description": "As a dungeon builder, I want production to vary by time of day.",
      "acceptanceCriteria": [
        "Night gives certain rooms a bonus (e.g., Shadow rooms +20% at night)",
        "Day gives certain rooms a bonus (e.g., Grove rooms +15% during day)",
        "Modifiers transition at defined thresholds as time changes",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Night (18:00-05:59): Shadow Library +20%, Soul Well +15%. Day (06:00-17:59): Mushroom Grove +15%, Crystal Mine +10%. Thresholds at hours 6 and 18."
    },
    {
      "id": "US-004",
      "title": "Implement fear-based modifiers",
      "description": "As the system, I want fear levels to modify production so that fear has gameplay consequences.",
      "acceptanceCriteria": [
        "Rooms with High or Very High fear apply a production modifier to inhabitants",
        "Modifier varies by inhabitant type (some thrive in fear, others suffer)",
        "Fear modifiers recalculated when room fear level changes",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Already implemented in conditional-state-modifiers (10.1). Per-creature scared state modifiers with fearTolerance thresholds. Kobold scared = +10% production, Goblin scared = -50%. Flows through calculatePerCreatureProductionModifier in state-modifiers.ts."
    },
    {
      "id": "US-005",
      "title": "Implement hunger-based modifiers",
      "description": "As the system, I want hunger state to modify production.",
      "acceptanceCriteria": [
        "Hungry inhabitants produce at 0.5x multiplier",
        "Starving inhabitants produce at 0.1x multiplier",
        "Fed inhabitants produce at 1.0x (no modifier)",
        "Hunger modifiers recalculated when hunger state changes",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Already implemented in conditional-state-modifiers (10.1). Per-creature hungry state modifiers. Goblin hungry = 0.5x, Kobold hungry = 0.7x, Skeleton hungry = 1.0x. Starving state deferred to hunger-system (Phase 11)."
    },
    {
      "id": "US-006",
      "title": "Implement floor depth and biome modifiers",
      "description": "As a developer, I want floor depth and biome to apply production modifiers.",
      "acceptanceCriteria": [
        "Deeper floors grant production bonuses (e.g., +5% per floor depth)",
        "Biome types apply modifiers to compatible rooms",
        "Modifiers applied based on the room's floor location",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Floor depth: +5% per depth level (depth 0 = +0%, depth 5 = +25%). Biome bonuses: volcanic→Crystal Mine +15%, fungal→Mushroom Grove +20%, crystal→Crystal Mine +25%/Ley Line Nexus +10%, corrupted→Soul Well +20%/Shadow Library +15%, flooded→Underground Lake +20%, neutral→no bonus."
    }
  ]
}
