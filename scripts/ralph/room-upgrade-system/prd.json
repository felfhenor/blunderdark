{
  "project": "Blunderdark",
  "branchName": "ralph/room-upgrade-system",
  "description": "Room upgrade system with mutually exclusive paths, tiered unlocking, immediate effect application, and visual indicators on upgraded rooms",
  "userStories": [
    {
      "id": "US-001",
      "title": "Upgrade Data Model",
      "description": "As a developer, I want a typed data model for room upgrades so that upgrades are consistent and serializable",
      "acceptanceCriteria": [
        "A RoomUpgrade type is defined with: id, name, description, tier, pathId, cost, effects",
        "An UpgradeEffect type defines what the upgrade changes (e.g. { field: 'maxInhabitants', modifier: 2 })",
        "Room instances in game state track appliedUpgrades: string[] and lockedPaths: string[]",
        "The data model supports arbitrary upgrade tiers",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Apply Upgrade Effects Immediately",
      "description": "As a dungeon builder, I want upgrade effects to take effect immediately so that I see the benefit right away",
      "acceptanceCriteria": [
        "Production bonuses apply in the next tick after purchase",
        "Capacity increases allow immediate inhabitant assignment",
        "Fear level changes propagate immediately",
        "The room's stats display updates to reflect the upgrade",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Mutually Exclusive Path Selection",
      "description": "As a dungeon builder, I want choosing one upgrade path to lock out the alternatives so that my choices are meaningful",
      "acceptanceCriteria": [
        "Selecting an upgrade path shows a confirmation dialog",
        "After confirming, the chosen path is applied and alternatives are permanently locked",
        "Locked paths show a Locked indicator with a reason",
        "The lock is permanent and persists across save/load",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Tiered Upgrade Unlocking",
      "description": "As a dungeon builder, I want Tier 1 upgrades to unlock Tier 2 options so that rooms can be progressively enhanced",
      "acceptanceCriteria": [
        "Tier 2 upgrades are hidden or grayed out until a Tier 1 upgrade is purchased",
        "After purchasing a Tier 1 upgrade, its corresponding Tier 2 options appear",
        "Tier 2 upgrades may also have mutually exclusive paths",
        "The upgrade panel clearly indicates tier levels",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Upgrade Panel UI",
      "description": "As a dungeon builder, I want to open an upgrade panel for a room so that I can see my upgrade options",
      "acceptanceCriteria": [
        "Clicking/selecting a room shows an Upgrades tab or button",
        "The upgrade panel lists all available upgrade paths for the room",
        "Each path shows its name, description, cost, and effect",
        "Already-chosen upgrades are highlighted; locked-out paths are grayed out",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Display Upgrade Costs",
      "description": "As a dungeon builder, I want to see the resource cost of each upgrade so that I can plan my spending",
      "acceptanceCriteria": [
        "Each upgrade shows its cost in the relevant resource types",
        "The player's current resource balance is shown for comparison",
        "Affordable upgrades have an active Purchase button",
        "Unaffordable upgrades have a disabled button with Insufficient resources",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Visual Upgrade Indicator",
      "description": "As a dungeon builder, I want upgraded rooms to look different on the grid so that I can see my progress at a glance",
      "acceptanceCriteria": [
        "Upgraded rooms show a small icon/badge on the grid (e.g. star or level number)",
        "The indicator changes with upgrade tier (e.g. bronze star for T1, silver for T2)",
        "Non-upgraded rooms do not show the indicator",
        "The indicator does not obscure important room information",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    }
  ]
}
