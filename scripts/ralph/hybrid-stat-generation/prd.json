{
  "project": "Blunderdark",
  "branchName": "ralph/hybrid-stat-generation",
  "description": "Hybrid Stat Generation - Determines how hybrid creature stats and traits are calculated from two parents using defined formulas (averaged stats, trait union, bonus traits, stat overrides) with dual parent icon display.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement pure stat generation function with inheritance formulas",
      "description": "As a developer, I want a pure function that generates hybrid stats from two parents using defined formulas so that fusion results are deterministic.",
      "acceptanceCriteria": [
        "A function generateHybridStats(parentA, parentB, recipe) exists in src/app/helpers/",
        "HP = Math.floor((Parent A HP + Parent B HP) / 2)",
        "Attack = Math.floor((Parent A Attack + Parent B Attack) / 2)",
        "Defense = Math.floor((Parent A Defense + Parent B Defense) / 2)",
        "Speed = Math.floor((Parent A Speed + Parent B Speed) / 2)",
        "Worker Efficiency = (Parent A Efficiency + Parent B Efficiency) / 2 (decimal, not floored)",
        "Function returns a complete stat block for the hybrid",
        "Function is pure with no side effects and deterministic output",
        "Function handles edge cases (zero stats, missing traits)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement trait union inheritance and bonus traits",
      "description": "As a developer, I want hybrids to inherit all traits from both parents plus bonus traits so that they combine their parents' abilities.",
      "acceptanceCriteria": [
        "Hybrid traits = set union of Parent A traits and Parent B traits (no duplicates)",
        "Conflicting traits follow a defined resolution rule (favor higher-tier parent's version)",
        "Bonus traits defined per hybrid in YAML are added on top of inherited traits",
        "At least 5 hybrids have unique bonus traits (e.g., Death Knight gains 'Spectral Charge')",
        "Stat overrides from hybrid YAML definitions replace formula-calculated values for specified stats only",
        "Hybrid tier is taken from the hybrid's YAML definition, not calculated",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement hybrid instance creation",
      "description": "As a developer, I want to create a fully realized hybrid inhabitant instance from generated stats so that it integrates with the existing inhabitant system.",
      "acceptanceCriteria": [
        "A function creates a new inhabitant instance with: generated stats, combined traits, bonus traits, hybrid flag, parent references",
        "Instance includes: id (unique), name, type, tier, stats, traits, hybrid: true, fusedFrom: [parentA.id, parentB.id]",
        "Instance is compatible with the existing inhabitant data model",
        "Instance can be saved to IndexedDB and loaded correctly",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Write comprehensive unit tests for stat generation",
      "description": "As a developer, I want comprehensive tests for all stat generation formulas so that hybrid creation is reliable.",
      "acceptanceCriteria": [
        "Test: Goblin (30 HP) + Kobold (20 HP) = Hobgoblin (25 HP)",
        "Test: Skeleton (40 HP) + Wraith (25 HP) = Death Knight (32 HP)",
        "Test: Attack, Defense, Speed averaging for at least 3 parent combinations each",
        "Test: Worker Efficiency averaging (decimal precision)",
        "Test: Trait union with no duplicates, conflicting traits, bonus traits",
        "Test: Stat overrides applied correctly, unspecified stats use formula",
        "Tests in src/app/helpers/ spec files",
        "All tests pass with npm run test",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Display dual parent icons for hybrids in UI",
      "description": "As a dungeon builder, I want hybrids to display both parent icons in the UI so that I can quickly identify their lineage.",
      "acceptanceCriteria": [
        "Hybrid inhabitants show a composite icon with both parent sprites (split or overlay layout)",
        "The hybrid's own name is displayed below the composite icon",
        "Composite icon works in all UI contexts: roster, room panel, tooltips",
        "Bonus traits are displayed with a special indicator",
        "Uses NgOptimizedImage for parent sprites",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ]
}
